{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BitStuffing = void 0;\n\nclass BitStuffing {\n  *escape(buffer) {\n    const {\n      FS,\n      FE,\n      ESC,\n      XM\n    } = BitStuffing;\n    yield FS;\n\n    for (const byte of buffer) {\n      if ([FS, FE, ESC].includes(byte)) {\n        yield ESC;\n        yield byte ^ XM;\n      } else {\n        yield byte;\n      }\n    }\n\n    yield FE;\n  }\n\n  *unescape(buffer) {\n    const {\n      ESC,\n      XM,\n      FS,\n      FE\n    } = BitStuffing;\n    let needXor = false;\n\n    if (buffer[0] !== FS) {\n      throw new Error(`First byte should be FS (${FS})`);\n    }\n\n    if (buffer[buffer.length - 1] !== FE) {\n      throw new Error(`Last byte should be FE (${FE})`);\n    }\n\n    const payload = buffer.slice(1, -1);\n\n    for (const byte of payload) {\n      if (byte === ESC) {\n        needXor = true;\n        continue;\n      }\n\n      if (needXor) {\n        yield byte ^ XM;\n        needXor = false;\n      } else {\n        yield byte;\n      }\n    }\n  }\n\n}\n\nexports.BitStuffing = BitStuffing;\nBitStuffing.FS = 0x02;\nBitStuffing.FE = 0x17;\nBitStuffing.ESC = 0x1B;\nBitStuffing.XM = 0x0E;","map":{"version":3,"mappings":";;;;;;;AAEA,MAAaA,WAAb,CAAwB;AAMR,GAANC,MAAM,CAACC,MAAD,EAAe;AAC3B,UAAM;AAAEC,QAAF;AAAMC,QAAN;AAAUC,SAAV;AAAeC;AAAf,QAAsBN,WAA5B;AAEA,UAAMG,EAAN;;AAEA,SAAK,MAAMI,IAAX,IAAmBL,MAAnB,EAA2B;AACzB,UAAI,CAACC,EAAD,EAAKC,EAAL,EAASC,GAAT,EAAcG,QAAd,CAAuBD,IAAvB,CAAJ,EAAkC;AAChC,cAAMF,GAAN;AACA,cAAME,IAAI,GAAGD,EAAb;AACD,OAHD,MAGO;AACL,cAAMC,IAAN;AACD;AACF;;AAED,UAAMH,EAAN;AACD;;AAEe,GAARK,QAAQ,CAACP,MAAD,EAAe;AAC7B,UAAM;AAAEG,SAAF;AAAOC,QAAP;AAAWH,QAAX;AAAeC;AAAf,QAAsBJ,WAA5B;AACA,QAAIU,OAAO,GAAG,KAAd;;AAEA,QAAIR,MAAM,CAAC,CAAD,CAAN,KAAcC,EAAlB,EAAsB;AACpB,YAAM,IAAIQ,KAAJ,CAAU,4BAA4BR,EAAE,GAAxC,CAAN;AACD;;AAED,QAAID,MAAM,CAACA,MAAM,CAACU,MAAP,GAAe,CAAhB,CAAN,KAA6BR,EAAjC,EAAqC;AACnC,YAAM,IAAIO,KAAJ,CAAU,2BAA2BP,EAAE,GAAvC,CAAN;AACD;;AAED,UAAMS,OAAO,GAAGX,MAAM,CAACY,KAAP,CAAa,CAAb,EAAgB,CAAC,CAAjB,CAAhB;;AAEA,SAAK,MAAMP,IAAX,IAAmBM,OAAnB,EAA4B;AAC1B,UAAIN,IAAI,KAAKF,GAAb,EAAkB;AAChBK,eAAO,GAAG,IAAV;AACA;AACD;;AAED,UAAIA,OAAJ,EAAa;AACX,cAAMH,IAAI,GAAGD,EAAb;AACAI,eAAO,GAAG,KAAV;AACD,OAHD,MAGO;AACL,cAAMH,IAAN;AACD;AACF;AACF;;AAlDqB;;AAAxBQ;AACgBf,iBAAK,IAAL;AACAA,iBAAK,IAAL;AACAA,kBAAM,IAAN;AACAA,iBAAK,IAAL","names":["BitStuffing","escape","buffer","FS","FE","ESC","XM","byte","includes","unescape","needXor","Error","length","payload","slice","exports"],"sources":["../src/bit-stuffing.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}